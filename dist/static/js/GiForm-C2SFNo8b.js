import{o as e}from"./omit-CF_GuFPb.js";import{d as l,c as a,I as o,e as t,V as s,f2 as r,a2 as d,f as i,o as u,a as n,w as f,i as p,m as c,h as m,g as y,F as h,k as g,R as b,D as v,t as _,r as k,C as V,b as x,_ as w}from"./index-CTftGuoI.js";const C=w(l({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(l,{expose:w,emit:C}){const B=l,P=C,F=a((()=>{const l=e(B,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:B.search?"inline":"horizontal",...l}})),I=a((()=>B.gridItemProps)),q=o("formRef"),$=t(B.defaultCollapsed),A=s({}),j=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),E=e=>{if(e.type)return["input","input-tag","mention"].includes(e.type)?`请输入${e.label}`:["textarea"].includes(e.type)?`请填写${e.label}`:["select","tree-select","cascader"].includes(e.type)?`请选择${e.label}`:["date-picker"].includes(e.type)?"请选择日期":["time-picker"].includes(e.type)?"请选择时间":void 0},R=e=>{if(!e.type)return;return["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type)?A[e.field]||[]:void 0},T=e=>({...j.get(e.type)||{},placeholder:E(e),options:R(e),...e.props}),z=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,L=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show(B.modelValue):void 0,O=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide(B.modelValue):void 0),S=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled(B.modelValue):void 0);B.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(B.modelValue).then((l=>{A[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const U=[];B.columns.forEach((e=>{var l;const a=U.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&U.push(e)}));const D=a((()=>r(B.modelValue)));return d(D,((e,l)=>{U.forEach((a=>{if(e[a.field]!==l[a.field]){B.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request(B.modelValue).then((e=>{A[l.field]=l.resultFormat?l.resultFormat(e):e.data,A[l.field].map((e=>e.value)).includes(B.modelValue[l.field])||P("update:modelValue",Object.assign(B.modelValue,{[l.field]:Array.isArray(B.modelValue[l.field])?[]:""}))})):l.request&&!e[a.field]&&(A[l.field]=[],P("update:modelValue",Object.assign(B.modelValue,{[l.field]:Array.isArray(B.modelValue[l.field])?[]:""})))}))}}))})),w({formRef:q}),(e,l)=>{const a=i("a-alert"),o=i("a-form-item"),t=i("a-grid-item"),s=i("icon-search"),r=i("a-button"),d=i("icon-up"),w=i("icon-down"),C=i("a-space"),A=i("a-grid"),j=i("a-form");return u(),n(j,c({ref_key:"formRef",ref:q},m(F),{model:e.modelValue}),{default:f((()=>[p(A,c({class:"w-full","col-gap":8},B.gridProps,{collapsed:m($)}),{default:f((()=>{var i;return[(u(!0),y(h,null,g(e.columns,(l=>{var s,r;return u(),y(h,{key:l.field},[(void 0!==l.show?L(l):!O(l))?(u(),n(t,c({key:0,ref_for:!0},l.gridItemProps||m(I),{span:l.span||(null==(s=l.gridItemProps)?void 0:s.span)||(null==(r=m(I))?void 0:r.span)}),{default:f((()=>[p(o,c({ref_for:!0},l.formItemProps,{field:l.field,rules:z(l),disabled:S(l)}),b({label:f((()=>["string"==typeof l.label?(u(),y(h,{key:0},[v(_(l.label),1)],64)):(u(),n(k(l.label),{key:1}))])),default:f((()=>[["group-title"].includes(l.type||"")?V(e.$slots,"group-title",{key:1},(()=>[p(a,c({ref_for:!0},l.props),{default:f((()=>[v(_(l.label),1)])),_:2},1040)]),!0):V(e.$slots,l.field,c({key:0,ref_for:!0},{disabled:S(l)}),(()=>[(u(),n(k(`a-${l.type}`),c({ref_for:!0},T(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void P("update:modelValue",Object.assign(B.modelValue,{[o]:a}));var a,o}}),b({_:2},[g(null==l?void 0:l.slots,((e,l)=>({name:l,fn:f((l=>["string"==typeof e?(u(),y(h,{key:0},[v(_(e),1)],64)):e?(u(),n(k(e(l)),{key:1})):x("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[g(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:f((()=>["string"==typeof e?(u(),y(h,{key:0},[v(_(e),1)],64)):(u(),n(k(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])):x("",!0)],64)})),128)),B.search?(u(),n(t,c({key:B.suffix?void 0:String(m($))},m(I),{span:null==(i=m(I))?void 0:i.span,suffix:B.search&&(B.suffix||!B.suffix&&m($))}),{default:f((()=>[p(C,{wrap:""},{default:f((()=>[V(e.$slots,"suffix",{},(()=>[p(r,{type:"primary",onClick:l[0]||(l[0]=e=>P("search"))},{icon:f((()=>[p(s)])),default:f((()=>[v(_(B.searchBtnText),1)])),_:1}),p(r,{onClick:l[1]||(l[1]=e=>P("reset"))},{default:f((()=>l[3]||(l[3]=[v("重置")]))),_:1}),B.hideFoldBtn?x("",!0):(u(),n(r,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>$.value=!m($))},{icon:f((()=>[m($)?(u(),n(w,{key:1})):(u(),n(d,{key:0}))])),default:f((()=>[v(_(m($)?"展开":"收起"),1)])),_:1}))]),!0)])),_:3})])),_:3},16,["span","suffix"])):x("",!0)]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-c2a116a2"]]);export{C as _};
