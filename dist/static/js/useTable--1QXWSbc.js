import{V as e,a2 as a,a0 as t,e as n,c as s,J as l,M as i}from"./index-DNkAVoEn.js";import{u as o}from"./useBreakpoint-D1YqlRYA.js";function r(r,c){const{formatResult:u,onSuccess:d,immediate:g=!0,rowKey:h="id"}=c||{},{pagination:p,setTotal:v}=function(n,s={defaultPageSize:10}){const{breakpoint:l}=o(),i=e({showPageSize:!0,showTotal:!0,current:1,pageSize:s.defaultPageSize,total:0,simple:!1,onChange:e=>{i.current=e,n&&n()},onPageSizeChange:e=>{i.current=1,i.pageSize=e,n&&n()}});a((()=>l.value),(()=>{i.simple=["xs"].includes(l.value),i.showTotal=!["xs"].includes(l.value)}),{immediate:!0});const r=i.onChange,c=i.onPageSizeChange,{current:u,pageSize:d,total:g}=t(i);return{current:u,pageSize:d,total:g,pagination:i,changeCurrent:r,changePageSize:c,setTotal:function(e){i.total=e}}}((()=>z())),f=n(!1),m=n([]);async function z(){try{f.value=!0;const e=await r({page:p.current,size:p.pageSize}),a=Array.isArray(e.data)?e.data:e.data.records;m.value=u?u(a):a;const t=Array.isArray(e.data)?a.length:e.data.total;v(t),null==d||d()}finally{f.value=!1}}g&&z();const S=n([]),{breakpoint:y}=o(),w=s((()=>["xs","sm"].includes(y.value)?void 0:"right"));return{loading:f,tableData:m,getTableData:z,search:()=>{S.value=[],p.onChange(1)},pagination:p,selectedKeys:S,select:e=>{S.value=e},selectAll:e=>{const a=m.value.filter((e=>!(null==e?void 0:e.disabled)));S.value=e?a.map((e=>e[h])):[]},handleDelete:async(e,a)=>{const t=async t=>{try{const n=await e();if(n.success){i.success((null==a?void 0:a.successTip)||"删除成功！");const e=t?S.value.length:1,n=Math.ceil((p.total-e)/p.pageSize);p.current>n&&(p.current=n>0?n:1),t&&(S.value=[]),z()}return n.success}catch(n){return!1}};if(!((null==a?void 0:a.showModal)??1))return t(!1);l.warning({title:(null==a?void 0:a.title)||"提示",content:(null==a?void 0:a.content)||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:()=>t(!0)})},refresh:()=>{z()},fixed:w}}export{r as u};
