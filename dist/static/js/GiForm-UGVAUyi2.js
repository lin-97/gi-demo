import{o as e}from"./omit-BGEBym14.js";import{d as l,c as a,I as o,e as t,V as s,f3 as r,a3 as d,f as i,a as u,o as n,m as f,h as p,w as c,j as m,g as y,b as h,k as b,F as g,R as v,G as _,t as k,r as V,C as x,_ as w}from"./index-CaTNYhxh.js";const C=w(l({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(l,{expose:w,emit:C}){const B=l,P=C,F=a(()=>{const l=e(B,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:B.search?"inline":"horizontal",...l}}),I=a(()=>B.gridItemProps),q=o("formRef"),$=t(B.defaultCollapsed),A=s({}),j=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),R=e=>{if(e.type)return["input","input-tag","mention"].includes(e.type)?`请输入${e.label}`:["textarea"].includes(e.type)?`请填写${e.label}`:["select","input-search","tree-select","cascader"].includes(e.type)?`请选择${e.label}`:["date-picker"].includes(e.type)?"请选择日期":["time-picker"].includes(e.type)?"请选择时间":void 0},E=e=>{if(!e.type)return;return["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type)?A[e.field]||[]:void 0},T=e=>({...j.get(e.type)||{},placeholder:R(e),options:E(e),...e.props}),z=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,L=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show(B.modelValue):void 0,O=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide(B.modelValue):void 0),G=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled(B.modelValue):void 0);B.columns.forEach(e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(B.modelValue).then(l=>{A[e.field]=e.resultFormat?e.resultFormat(l):l.data})});const S=[];B.columns.forEach(e=>{var l;const a=S.map(e=>e.field);(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&S.push(e)});const U=a(()=>r(B.modelValue));return d(U,(e,l)=>{S.forEach(a=>{if(e[a.field]!==l[a.field]){B.columns.filter(e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)}).forEach(l=>{l.request&&Boolean(e[a.field])?l.request(B.modelValue).then(e=>{A[l.field]=l.resultFormat?l.resultFormat(e):e.data,A[l.field].map(e=>e.value).includes(B.modelValue[l.field])||P("update:modelValue",Object.assign(B.modelValue,{[l.field]:Array.isArray(B.modelValue[l.field])?[]:""}))}):l.request&&!e[a.field]&&(A[l.field]=[],P("update:modelValue",Object.assign(B.modelValue,{[l.field]:Array.isArray(B.modelValue[l.field])?[]:""})))})}})}),w({formRef:q}),(e,l)=>{const a=i("a-alert"),o=i("a-form-item"),t=i("a-grid-item"),s=i("icon-search"),r=i("a-button"),d=i("icon-up"),w=i("icon-down"),C=i("a-space"),A=i("a-grid"),j=i("a-form");return n(),u(j,f({ref_key:"formRef",ref:q},p(F),{model:e.modelValue}),{default:c(()=>[m(A,f({class:"w-full","col-gap":8},B.gridProps,{collapsed:p($)}),{default:c(()=>{var i;return[(n(!0),y(g,null,b(e.columns,l=>{var s,r;return n(),y(g,{key:l.field},[(void 0!==l.show?L(l):!O(l))?(n(),u(t,f({key:0,ref_for:!0},l.gridItemProps||p(I),{span:l.span||(null==(s=l.gridItemProps)?void 0:s.span)||(null==(r=p(I))?void 0:r.span)}),{default:c(()=>[m(o,f({ref_for:!0},l.formItemProps,{field:l.field,rules:z(l),disabled:G(l)}),v({label:c(()=>[l.labelRender?(n(),u(V(l.labelRender),{key:0})):(n(),y(g,{key:1},[_(k(l.label),1)],64))]),default:c(()=>[["group-title"].includes(l.type||"")?x(e.$slots,"group-title",{key:1},()=>[m(a,f({ref_for:!0},l.props),{default:c(()=>[_(k(l.label),1)]),_:2},1040)],!0):x(e.$slots,l.field,f({key:0,ref_for:!0},{disabled:G(l)}),()=>[(n(),u(V(`a-${l.type}`),f({ref_for:!0},T(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void P("update:modelValue",Object.assign(B.modelValue,{[o]:a}));var a,o}}),v({_:2},[b(null==l?void 0:l.slots,(e,l)=>({name:l,fn:c(l=>["string"==typeof e?(n(),y(g,{key:0},[_(k(e),1)],64)):e?(n(),u(V(e(l)),{key:1})):h("",!0)])}))]),1040,["model-value","onUpdate:modelValue"]))],!0)]),_:2},[b(null==l?void 0:l.formItemSlots,(e,l)=>({name:l,fn:c(()=>["string"==typeof e?(n(),y(g,{key:0},[_(k(e),1)],64)):(n(),u(V(e),{key:1}))])}))]),1040,["field","rules","disabled"])]),_:2},1040,["span"])):h("",!0)],64)}),128)),B.search?(n(),u(t,f({key:B.suffix?void 0:String(p($))},p(I),{span:null==(i=p(I))?void 0:i.span,suffix:B.search&&(B.suffix||!B.suffix&&p($))}),{default:c(()=>[m(C,{wrap:""},{default:c(()=>[x(e.$slots,"suffix",{},()=>[m(r,{type:"primary",onClick:l[0]||(l[0]=e=>P("search"))},{icon:c(()=>[m(s)]),default:c(()=>[_(k(B.searchBtnText),1)]),_:1}),m(r,{onClick:l[1]||(l[1]=e=>P("reset"))},{default:c(()=>l[3]||(l[3]=[_("重置",-1)])),_:1,__:[3]}),B.hideFoldBtn?h("",!0):(n(),u(r,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>$.value=!p($))},{icon:c(()=>[p($)?(n(),u(w,{key:1})):(n(),u(d,{key:0}))]),default:c(()=>[_(k(p($)?"展开":"收起"),1)]),_:1}))],!0)]),_:3})]),_:3},16,["span","suffix"])):h("",!0)]}),_:3},16,["collapsed"])]),_:3},16,["model"])}}}),[["__scopeId","data-v-8da42873"]]);export{C as _};
