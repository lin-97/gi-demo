import{a as e,E as l}from"./regexp-CZKnpGWl.js";import{b as a}from"./user-BK7gMjEL.js";import{u as d}from"./useDept-Bj6VLZ0Q.js";import{b as t}from"./role-OoDcevB-.js";import{e as s,d as o,c as i,I as u,f as m,a as r,o as n,h as c,D as p,w as f,j as h,X as g,Y as v,G as b,J as V}from"./index-TfpzvVHF.js";import{u as _}from"./useResetReactive-6TTKur6Y.js";const w=o({__name:"AddUserModal",emits:["save-success"],setup(o,{expose:w,emit:x}){const k=x,{roleList:y,getRoleList:I}=function(){const e=s(!1),l=s([]),a=s(0);return{roleList:l,getRoleList:async()=>{try{e.value=!0;const d=await t.getList({page:1,size:99});l.value=d.data.records.filter((e=>1===e.status)),a.value=d.data.total}finally{e.value=!1}},loading:e,total:a}}();I();const U=i((()=>y.value.map((e=>({label:e.name,value:e.code}))))),{deptList:j,getDeptList:L}=d();L();const R={xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},M=u("formRef"),q=s(""),D=i((()=>!!q.value)),z=i((()=>D.value?"编辑用户":"新增用户")),E=s(!1),[O,W]=_({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:"",roleIds:[],description:"",status:1,type:2,disabled:!1}),A={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:l,message:"邮箱格式不正确"}],phone:[{match:e,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},B=()=>{var e;null==(e=M.value)||e.resetFields(),W()},C=async()=>{var e;try{if(await(null==(e=M.value)?void 0:e.validate()))return!1;return!!(await await new Promise((e=>setTimeout((()=>e(!0)),300))))&&(V.success("模拟保存成功"),k("save-success"),!0)}catch{return!1}};return w({add:()=>{q.value="",E.value=!0},edit:async e=>{E.value=!0,q.value=e;const l=await a.getDetail({id:e});Object.assign(O,l.data)}}),(e,l)=>{const a=m("a-input"),d=m("a-form-item"),t=m("a-col"),s=m("a-row"),o=m("a-radio"),i=m("a-radio-group"),u=m("a-tree-select"),V=m("a-select"),_=m("a-textarea"),w=m("a-switch"),x=m("a-form"),k=m("a-modal");return n(),r(k,{visible:c(E),"onUpdate:visible":l[9]||(l[9]=e=>p(E)?E.value=e:null),title:c(z),width:"90%","mask-closable":!1,"modal-style":{maxWidth:"600px"},"body-style":{maxHeight:"70vh"},onBeforeOk:C,onClose:B},{default:f((()=>[h(x,{ref_key:"formRef",ref:M,model:c(O),rules:A,size:"medium","auto-label-width":""},{default:f((()=>[h(s,null,{default:f((()=>[h(t,g(v(R)),{default:f((()=>[h(d,{label:"用户名",field:"username"},{default:f((()=>[h(a,{modelValue:c(O).username,"onUpdate:modelValue":l[0]||(l[0]=e=>c(O).username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":"",disabled:c(O).disabled,"max-length":10},null,8,["modelValue","disabled"])])),_:1})])),_:1},16),h(t,g(v(R)),{default:f((()=>[h(d,{label:"昵称",field:"nickname"},{default:f((()=>[h(a,{modelValue:c(O).nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>c(O).nickname=e),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":"","max-length":10},null,8,["modelValue"])])),_:1})])),_:1},16),h(t,g(v(R)),{default:f((()=>[h(d,{label:"手机号码",field:"phone"},{default:f((()=>[h(a,{modelValue:c(O).phone,"onUpdate:modelValue":l[2]||(l[2]=e=>c(O).phone=e),modelModifiers:{trim:!0},placeholder:"请输入手机号码","allow-clear":"","max-length":11},null,8,["modelValue"])])),_:1})])),_:1},16),h(t,g(v(R)),{default:f((()=>[h(d,{label:"邮箱",field:"email"},{default:f((()=>[h(a,{modelValue:c(O).email,"onUpdate:modelValue":l[3]||(l[3]=e=>c(O).email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱","allow-clear":"","max-length":30},null,8,["modelValue"])])),_:1})])),_:1},16)])),_:1}),h(d,{label:"性别",field:"gender"},{default:f((()=>[h(i,{modelValue:c(O).gender,"onUpdate:modelValue":l[4]||(l[4]=e=>c(O).gender=e)},{default:f((()=>[h(o,{value:1},{default:f((()=>l[10]||(l[10]=[b("男")]))),_:1,__:[10]}),h(o,{value:2},{default:f((()=>l[11]||(l[11]=[b("女")]))),_:1,__:[11]})])),_:1},8,["modelValue"])])),_:1}),h(d,{label:"所属部门",field:"deptId"},{default:f((()=>[h(u,{modelValue:c(O).deptId,"onUpdate:modelValue":l[5]||(l[5]=e=>c(O).deptId=e),data:c(j),"field-names":{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:c(O).disabled},null,8,["modelValue","data","disabled"])])),_:1}),h(d,{label:"角色",field:"roleIds",disabled:c(O).disabled},{default:f((()=>[h(V,{modelValue:c(O).roleIds,"onUpdate:modelValue":l[6]||(l[6]=e=>c(O).roleIds=e),options:c(U),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),h(d,{label:"描述",field:"description"},{default:f((()=>[h(_,{modelValue:c(O).description,"onUpdate:modelValue":l[7]||(l[7]=e=>c(O).description=e),modelModifiers:{trim:!0},"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),h(d,{label:"状态",field:"status"},{default:f((()=>[h(w,{modelValue:c(O).status,"onUpdate:modelValue":l[8]||(l[8]=e=>c(O).status=e),type:"round","checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{w as _};
