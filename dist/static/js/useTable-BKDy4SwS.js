import{U as e,a1 as a,$ as t,e as n,c as s,J as l,M as i}from"./index-D1TUixoq.js";import{u as o}from"./useBreakpoint-LcsoXmFk.js";function r(r,c){const{formatResult:u,onSuccess:d,immediate:g=!0,rowKey:p="id"}=c||{},{pagination:h,setTotal:v}=function(n,s={defaultPageSize:10}){const{breakpoint:l}=o(),i=e({showPageSize:!0,showTotal:!0,current:1,pageSize:s.defaultPageSize,total:0,simple:!1,onChange:e=>{i.current=e,n&&n()},onPageSizeChange:e=>{i.current=1,i.pageSize=e,n&&n()}});a((()=>l.value),(()=>{i.simple=["xs"].includes(l.value),i.showTotal=!["xs"].includes(l.value)}),{immediate:!0});const r=i.onChange,c=i.onPageSizeChange,{current:u,pageSize:d,total:g}=t(i);return{current:u,pageSize:d,total:g,pagination:i,changeCurrent:r,changePageSize:c,setTotal:function(e){i.total=e}}}((()=>y())),f=n(!1),m=n([]);async function y(){try{f.value=!0;const e=await r({page:h.current,size:h.pageSize}),a=Array.isArray(e.data)?e.data:e.data.records;m.value=u?u(a):a;const t=Array.isArray(e.data)?a.length:e.data.total;v(t),null==d||d()}finally{f.value=!1}}g&&y();const z=n([]),{breakpoint:S}=o(),w=s((()=>["xs","sm"].includes(S.value)?void 0:"right"));return{loading:f,tableData:m,getTableData:y,search:()=>{z.value=[],h.onChange(1)},pagination:h,selectedKeys:z,select:e=>{z.value=e},selectAll:e=>{const a=m.value.filter((e=>!(null==e?void 0:e.disabled)));z.value=e?a.map((e=>e[p])):[]},handleDelete:async(e,a)=>{const t=async()=>{try{const t=await e();return t.success&&(i.success((null==a?void 0:a.successTip)||"删除成功！"),z.value=[],y()),t.success}catch(t){return!1}};if(!((null==a?void 0:a.showModal)??1))return t();l.warning({title:(null==a?void 0:a.title)||"提示",content:(null==a?void 0:a.content)||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:t})},refresh:()=>{y()},fixed:w}}export{r as u};
