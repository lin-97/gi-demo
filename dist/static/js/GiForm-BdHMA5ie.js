import{o as e}from"./omit-n4ltMj-m.js";import{d as l,c as a,H as o,e as d,S as r,f0 as s,a1 as t,f as i,o as u,a as f,w as n,i as p,m as c,h as m,g as h,F as y,k as b,Q as g,D as v,t as _,r as k,C as V,b as w,_ as x}from"./index-D2ooPFP7.js";const C=x(l({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:{span:{xs:24,sm:12}}},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(l,{expose:x,emit:C}){const $=l,B=C,P=a((()=>{const l=e($,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:$.search?"inline":"horizontal",...l}})),F=a((()=>$.gridItemProps)),q=o("formRef"),I=d($.defaultCollapsed),A=r({}),j=e=>({...new Map([["input",{allowClear:!0,placeholder:`请输入${e.label}`,maxLength:20}],["input-number",{placeholder:`请输入${e.label}`}],["textarea",{allowClear:!1,placeholder:`请填写${e.label}`,maxLength:200}],["input-tag",{allowClear:!0,placeholder:`请输入${e.label}`}],["mention",{allowClear:!0,placeholder:`请输入${e.label}`}],["select",{allowClear:!0,placeholder:`请选择${e.label}`,options:A[e.field]||[]}],["tree-select",{allowClear:!0,placeholder:`请选择${e.label}`}],["cascader",{allowClear:!0,placeholder:`请选择${e.label}`,options:A[e.field]||[]}],["radio-group",{options:A[e.field]||[]}],["checkbox-group",{options:A[e.field]||[]}],["date-picker",{allowClear:!0,placeholder:"请选择日期"}],["time-picker",{allowClear:!0,placeholder:"请选择时间"}]]).get(e.type)||{},...e.props}),E=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,T=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show($.modelValue):void 0,z=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide($.modelValue):void 0),L=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled($.modelValue):void 0);$.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request($.modelValue).then((l=>{A[e.field]=e.resultFormat?e.resultFormat(l):l.data}))}));const O=[];$.columns.forEach((e=>{var l;const a=O.map((e=>e.field));(null==(l=e.cascader)?void 0:l.length)&&!a.includes(e.field)&&O.push(e)}));const R=a((()=>s($.modelValue)));return t(R,((e,l)=>{O.forEach((a=>{if(e[a.field]!==l[a.field]){$.columns.filter((e=>{var l;return null==(l=null==a?void 0:a.cascader)?void 0:l.includes(e.field)})).forEach((l=>{l.request&&Boolean(e[a.field])?l.request($.modelValue).then((e=>{A[l.field]=l.resultFormat?l.resultFormat(e):e.data,A[l.field].map((e=>e.value)).includes($.modelValue[l.field])||B("update:modelValue",Object.assign($.modelValue,{[l.field]:Array.isArray($.modelValue[l.field])?[]:""}))})):l.request&&!e[a.field]&&(A[l.field]=[],B("update:modelValue",Object.assign($.modelValue,{[l.field]:Array.isArray($.modelValue[l.field])?[]:""})))}))}}))})),x({formRef:q}),(e,l)=>{const a=i("a-alert"),o=i("a-form-item"),d=i("a-grid-item"),r=i("icon-search"),s=i("a-button"),t=i("icon-up"),x=i("icon-down"),C=i("a-space"),A=i("a-grid"),O=i("a-form");return u(),f(O,c({ref_key:"formRef",ref:q},m(P),{model:e.modelValue}),{default:n((()=>[p(A,c({class:"w-full","col-gap":8},$.gridProps,{collapsed:m(I)}),{default:n((()=>{var i;return[(u(!0),h(y,null,b(e.columns,(l=>{var r,s;return u(),h(y,{key:l.field},[(void 0!==l.show?T(l):!z(l))?(u(),f(d,c({key:0,ref_for:!0},l.gridItemProps||m(F),{span:l.span||(null==(r=l.gridItemProps)?void 0:r.span)||(null==(s=m(F))?void 0:s.span)}),{default:n((()=>[p(o,c({ref_for:!0},l.formItemProps,{field:l.field,rules:E(l),disabled:L(l)}),g({label:n((()=>["string"==typeof l.label?(u(),h(y,{key:0},[v(_(l.label),1)],64)):(u(),f(k(l.label),{key:1}))])),default:n((()=>[["group-title"].includes(l.type||"")?V(e.$slots,"group-title",{key:1},(()=>[p(a,c({ref_for:!0},l.props),{default:n((()=>[v(_(l.label),1)])),_:2},1040)]),!0):V(e.$slots,l.field,c({key:0,ref_for:!0},{disabled:L(l)}),(()=>[(u(),f(k(`a-${l.type}`),c({ref_for:!0},j(l),{"model-value":e.modelValue[l.field],"onUpdate:modelValue":e=>{return a=e,o=l.field,void B("update:modelValue",Object.assign($.modelValue,{[o]:a}));var a,o}}),g({_:2},[b(null==l?void 0:l.slots,((e,l)=>({name:l,fn:n((l=>["string"==typeof e?(u(),h(y,{key:0},[v(_(e),1)],64)):e?(u(),f(k(e(l)),{key:1})):w("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[b(null==l?void 0:l.formItemSlots,((e,l)=>({name:l,fn:n((()=>["string"==typeof e?(u(),h(y,{key:0},[v(_(e),1)],64)):(u(),f(k(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])):w("",!0)],64)})),128)),$.search?(u(),f(d,c({key:0},m(F),{span:null==(i=m(F))?void 0:i.span,suffix:$.search&&$.suffix}),{default:n((()=>[p(C,{wrap:""},{default:n((()=>[V(e.$slots,"suffix",{},(()=>[p(s,{type:"primary",onClick:l[0]||(l[0]=e=>B("search"))},{icon:n((()=>[p(r)])),default:n((()=>[v(_($.searchBtnText),1)])),_:1}),p(s,{onClick:l[1]||(l[1]=e=>B("reset"))},{default:n((()=>l[3]||(l[3]=[v("重置")]))),_:1}),$.hideFoldBtn?w("",!0):(u(),f(s,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=e=>I.value=!m(I))},{icon:n((()=>[m(I)?(u(),f(x,{key:1})):(u(),f(t,{key:0}))])),default:n((()=>[v(_(m(I)?"展开":"收起"),1)])),_:1}))]),!0)])),_:3})])),_:3},16,["span","suffix"])):w("",!0)]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-f5cfd0dd"]]);export{C as _};
