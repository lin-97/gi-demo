import{o as oe}from"./omit-BkSihji9.js";import{d2 as re,_ as ae}from"./index-DBvjnvFZ.js";import{e as le,c as F,ac as se,a as te,r as ne,w as de,h as u,j as f,k as s,E as p,a1 as n,l as t,t as _,n as k,p as v,P as I,F as C,G as T,y,z as m,O as x,u as $}from"./vue-_iYK9Zi6.js";const ue=le({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(E,{expose:O,emit:D}){const r=E,g=D,j=F(()=>{const e=oe(r,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:r.search?"inline":"horizontal",...e}}),w=F(()=>r.gridItemProps),q=se("formRef"),i=te(r.defaultCollapsed),h=ne({}),z=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),A=e=>e?.fieldName||e.field,L=e=>{if(e.type){if(["input","input-tag","mention"].includes(e.type))return`请输入${e.label}`;if(["textarea"].includes(e.type))return`请填写${e.label}`;if(["select","input-search","tree-select","cascader"].includes(e.type))return`请选择${e.label}`;if(["date-picker"].includes(e.type))return"请选择日期";if(["time-picker"].includes(e.type))return"请选择时间"}},N=e=>{if(!e.type)return;if(["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type))return h[e.field]||[]},G=e=>({...z.get(e.type)||{},placeholder:L(e),options:N(e),...e.props}),M=(e,a)=>{g("update:modelValue",Object.assign(r.modelValue,{[a]:e}))},U=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,H=e=>{if(typeof e.show=="boolean")return e.show;if(typeof e.show=="function")return e.show(r.modelValue)},W=e=>{if(e.hide===void 0)return!1;if(typeof e.hide=="boolean")return e.hide;if(typeof e.hide=="function")return e.hide(r.modelValue)},R=e=>{if(e.disabled===void 0)return!1;if(typeof e.disabled=="boolean")return e.disabled;if(typeof e.disabled=="function")return e.disabled(r.modelValue)};r.columns.forEach(e=>{e.request&&typeof e.request=="function"&&e?.init&&e.request(r.modelValue).then(a=>{h[e.field]=e.resultFormat?e.resultFormat(a):a.data})});const V=[];r.columns.forEach(e=>{const a=V.map(c=>c.field);e.cascader?.length&&!a.includes(e.field)&&V.push(e)});const J=F(()=>re(r.modelValue));return de(J,(e,a)=>{V.forEach(c=>{e[c.field]!==a[c.field]&&r.columns.filter(l=>c?.cascader?.includes(l.field)).forEach(l=>{l.request&&e[c.field]?l.request(r.modelValue).then(P=>{h[l.field]=l.resultFormat?l.resultFormat(P):P.data,h[l.field].map(b=>b.value).includes(r.modelValue[l.field])||g("update:modelValue",Object.assign(r.modelValue,{[l.field]:Array.isArray(r.modelValue[l.field])?[]:""}))}):l.request&&!e[c.field]&&(h[l.field]=[],g("update:modelValue",Object.assign(r.modelValue,{[l.field]:Array.isArray(r.modelValue[l.field])?[]:""})))})})}),O({formRef:q}),(e,a)=>{const c=u("a-alert"),S=u("a-form-item"),l=u("a-grid-item"),P=u("icon-search"),b=u("a-button"),K=u("icon-up"),Q=u("icon-down"),X=u("a-space"),Y=u("a-grid"),Z=u("a-form");return s(),f(Z,p({ref_key:"formRef",ref:q},n(j),{model:e.modelValue}),{default:t(()=>[_(Y,p({class:"w-full","col-gap":8},r.gridProps,{collapsed:n(i)}),{default:t(()=>[(s(!0),k(C,null,I(e.columns,o=>(s(),k(C,{key:o.field},[(o.show!==void 0?H(o):!W(o))?(s(),f(l,p({key:0,ref_for:!0},o.gridItemProps||n(w),{span:o.span||o.gridItemProps?.span||n(w)?.span}),{default:t(()=>[_(S,p({ref_for:!0},o.formItemProps,{field:o.field,rules:U(o),disabled:R(o)}),T({label:t(()=>[o.labelRender?(s(),f(x(o.labelRender),{key:0})):(s(),k(C,{key:1},[y(m(o.label),1)],64))]),default:t(()=>[["group-title"].includes(o.type||"")?$(e.$slots,"group-title",{key:1},()=>[_(c,p({ref_for:!0},o.props),{default:t(()=>[y(m(o.label),1)]),_:2},1040)],!0):$(e.$slots,o.field,p({key:0,ref_for:!0},{disabled:R(o)}),()=>[(s(),f(x(`a-${o.type}`),p({ref_for:!0},G(o),{"model-value":e.modelValue[A(o)],"onUpdate:modelValue":d=>M(d,A(o))}),T({_:2},[I(o?.slots,(d,B)=>({name:B,fn:t(ee=>[typeof d=="string"?(s(),k(C,{key:0},[y(m(d),1)],64)):d?(s(),f(x(d(ee)),{key:1})):v("",!0)])}))]),1040,["model-value","onUpdate:modelValue"]))],!0)]),_:2},[I(o?.formItemSlots,(d,B)=>({name:B,fn:t(()=>[typeof d=="string"?(s(),k(C,{key:0},[y(m(d),1)],64)):(s(),f(x(d),{key:1}))])}))]),1040,["field","rules","disabled"])]),_:2},1040,["span"])):v("",!0)],64))),128)),r.search?(s(),f(l,p({key:r.suffix?void 0:String(n(i))},n(w),{span:n(w)?.span,suffix:r.search&&(r.suffix||!r.suffix&&n(i))}),{default:t(()=>[_(X,{wrap:""},{default:t(()=>[$(e.$slots,"suffix",{},()=>[_(b,{type:"primary",onClick:a[0]||(a[0]=o=>g("search"))},{icon:t(()=>[_(P)]),default:t(()=>[y(m(r.searchBtnText),1)]),_:1}),_(b,{onClick:a[1]||(a[1]=o=>g("reset"))},{default:t(()=>a[3]||(a[3]=[y("重置",-1)])),_:1,__:[3]}),r.hideFoldBtn?v("",!0):(s(),f(b,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:a[2]||(a[2]=o=>i.value=!n(i))},{icon:t(()=>[n(i)?(s(),f(Q,{key:1})):(s(),f(K,{key:0}))]),default:t(()=>[y(m(n(i)?"展开":"收起"),1)]),_:1}))],!0)]),_:3})]),_:3},16,["span","suffix"])):v("",!0)]),_:3},16,["collapsed"])]),_:3},16,["model"])}}}),ie=ae(ue,[["__scopeId","data-v-2475c092"]]);export{ie as _};
