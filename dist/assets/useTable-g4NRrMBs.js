import{u as y}from"./useBreakpoint-DAFsyWcD.js";import"./index-DBvjnvFZ.js";import{r as M,w as k,v as B,a as p,c as K}from"./vue-_iYK9Zi6.js";import{ac as R,a9 as N}from"./arco-CDZlpuCh.js";function O(c,d={defaultPageSize:10}){const{breakpoint:l}=y(),t=M({showPageSize:!0,showTotal:!0,current:1,pageSize:d.defaultPageSize,total:0,simple:!1,onChange:a=>{t.current=a,c&&c()},onPageSizeChange:a=>{t.current=1,t.pageSize=a,c&&c()}});k(()=>l.value,()=>{t.simple=["xs"].includes(l.value),t.showTotal=!["xs"].includes(l.value)},{immediate:!0});const f=t.onChange,g=t.onPageSizeChange;function s(a){t.total=a}const{current:h,pageSize:i,total:u}=B(t);return{current:h,pageSize:i,total:u,pagination:t,changeCurrent:f,changePageSize:g,setTotal:s}}function G(c,d){const{formatResult:l,onSuccess:t,immediate:f=!0,rowKey:g="id"}=d||{},{pagination:s,setTotal:h}=O(()=>a()),i=p(!1),u=p([]);async function a(){try{i.value=!0;const e=await c({page:s.current,size:s.pageSize}),n=Array.isArray(e.data)?e.data:e.data.records;u.value=l?l(n):n;const r=Array.isArray(e.data)?n.length:e.data.total;h(r),t?.()}finally{i.value=!1}}f&&a();const o=p([]),z=e=>{o.value=e},w=e=>{const n=u.value.filter(r=>!(r?.disabled??!1));o.value=e?n.map(r=>r[g]):[]},C=()=>u.value.filter(e=>o.value.includes(e[g])),P=()=>{o.value=[],s.onChange(1)},T=()=>{a()},x=async(e,n)=>{const r=async S=>{try{const m=await e();if(m.success){N.success(n?.successTip||"删除成功！");const b=S?o.value.length:1,v=Math.ceil((s.total-b)/s.pageSize);s.current>v&&(s.current=v>0?v:1),S&&(o.value=[]),a()}return m.success}catch{return!1}};if(!(n?.showModal??!0))return r(!1);R.warning({title:n?.title||"提示",content:n?.content||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:()=>r(!0)})},{breakpoint:A}=y(),D=K(()=>["xs","sm"].includes(A.value)?void 0:"right");return{loading:i,tableData:u,getTableData:a,search:P,pagination:s,selectedKeys:o,select:z,selectAll:w,getSelectedData:C,handleDelete:x,refresh:T,fixed:D}}export{G as u};
