import{o as ee}from"./omit-D746qIin.js";import{d2 as re,_ as oe}from"./index-COakebNL.js";import{e as ae,c as F,ac as le,a as se,r as te,w as ne,h as u,j as f,k as s,E as p,a1 as n,l as t,t as _,n as k,p as v,P as I,F as C,G as S,y,z as m,O as x,u as $}from"./vue-_iYK9Zi6.js";const de=ae({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(T,{expose:E,emit:O}){const o=T,g=O,D=F(()=>{const e=ee(o,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:o.search?"inline":"horizontal",...e}}),w=F(()=>o.gridItemProps),q=le("formRef"),i=se(o.defaultCollapsed),h=te({}),j=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),z=e=>{if(e.type){if(["input","input-tag","mention"].includes(e.type))return`请输入${e.label}`;if(["textarea"].includes(e.type))return`请填写${e.label}`;if(["select","input-search","tree-select","cascader"].includes(e.type))return`请选择${e.label}`;if(["date-picker"].includes(e.type))return"请选择日期";if(["time-picker"].includes(e.type))return"请选择时间"}},L=e=>{if(!e.type)return;if(["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type))return h[e.field]||[]},G=e=>({...j.get(e.type)||{},placeholder:z(e),options:L(e),...e.props}),N=(e,a)=>{g("update:modelValue",Object.assign(o.modelValue,{[a]:e}))},U=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,H=e=>{if(typeof e.show=="boolean")return e.show;if(typeof e.show=="function")return e.show(o.modelValue)},M=e=>{if(e.hide===void 0)return!1;if(typeof e.hide=="boolean")return e.hide;if(typeof e.hide=="function")return e.hide(o.modelValue)},A=e=>{if(e.disabled===void 0)return!1;if(typeof e.disabled=="boolean")return e.disabled;if(typeof e.disabled=="function")return e.disabled(o.modelValue)};o.columns.forEach(e=>{e.request&&typeof e.request=="function"&&e?.init&&e.request(o.modelValue).then(a=>{h[e.field]=e.resultFormat?e.resultFormat(a):a.data})});const V=[];o.columns.forEach(e=>{const a=V.map(c=>c.field);e.cascader?.length&&!a.includes(e.field)&&V.push(e)});const W=F(()=>re(o.modelValue));return ne(W,(e,a)=>{V.forEach(c=>{e[c.field]!==a[c.field]&&o.columns.filter(l=>c?.cascader?.includes(l.field)).forEach(l=>{l.request&&e[c.field]?l.request(o.modelValue).then(P=>{h[l.field]=l.resultFormat?l.resultFormat(P):P.data,h[l.field].map(b=>b.value).includes(o.modelValue[l.field])||g("update:modelValue",Object.assign(o.modelValue,{[l.field]:Array.isArray(o.modelValue[l.field])?[]:""}))}):l.request&&!e[c.field]&&(h[l.field]=[],g("update:modelValue",Object.assign(o.modelValue,{[l.field]:Array.isArray(o.modelValue[l.field])?[]:""})))})})}),E({formRef:q}),(e,a)=>{const c=u("a-alert"),R=u("a-form-item"),l=u("a-grid-item"),P=u("icon-search"),b=u("a-button"),J=u("icon-up"),K=u("icon-down"),Q=u("a-space"),X=u("a-grid"),Y=u("a-form");return s(),f(Y,p({ref_key:"formRef",ref:q},n(D),{model:e.modelValue}),{default:t(()=>[_(X,p({class:"w-full","col-gap":8},o.gridProps,{collapsed:n(i)}),{default:t(()=>[(s(!0),k(C,null,I(e.columns,r=>(s(),k(C,{key:r.field},[(r.show!==void 0?H(r):!M(r))?(s(),f(l,p({key:0,ref_for:!0},r.gridItemProps||n(w),{span:r.span||r.gridItemProps?.span||n(w)?.span}),{default:t(()=>[_(R,p({ref_for:!0},r.formItemProps,{field:r.field,rules:U(r),disabled:A(r)}),S({label:t(()=>[r.labelRender?(s(),f(x(r.labelRender),{key:0})):(s(),k(C,{key:1},[y(m(r.label),1)],64))]),default:t(()=>[["group-title"].includes(r.type||"")?$(e.$slots,"group-title",{key:1},()=>[_(c,p({ref_for:!0},r.props),{default:t(()=>[y(m(r.label),1)]),_:2},1040)],!0):$(e.$slots,r.field,p({key:0,ref_for:!0},{disabled:A(r)}),()=>[(s(),f(x(`a-${r.type}`),p({ref_for:!0},G(r),{"model-value":e.modelValue[r.field],"onUpdate:modelValue":d=>N(d,r.field)}),S({_:2},[I(r?.slots,(d,B)=>({name:B,fn:t(Z=>[typeof d=="string"?(s(),k(C,{key:0},[y(m(d),1)],64)):d?(s(),f(x(d(Z)),{key:1})):v("",!0)])}))]),1040,["model-value","onUpdate:modelValue"]))],!0)]),_:2},[I(r?.formItemSlots,(d,B)=>({name:B,fn:t(()=>[typeof d=="string"?(s(),k(C,{key:0},[y(m(d),1)],64)):(s(),f(x(d),{key:1}))])}))]),1040,["field","rules","disabled"])]),_:2},1040,["span"])):v("",!0)],64))),128)),o.search?(s(),f(l,p({key:o.suffix?void 0:String(n(i))},n(w),{span:n(w)?.span,suffix:o.search&&(o.suffix||!o.suffix&&n(i))}),{default:t(()=>[_(Q,{wrap:""},{default:t(()=>[$(e.$slots,"suffix",{},()=>[_(b,{type:"primary",onClick:a[0]||(a[0]=r=>g("search"))},{icon:t(()=>[_(P)]),default:t(()=>[y(m(o.searchBtnText),1)]),_:1}),_(b,{onClick:a[1]||(a[1]=r=>g("reset"))},{default:t(()=>a[3]||(a[3]=[y("重置",-1)])),_:1,__:[3]}),o.hideFoldBtn?v("",!0):(s(),f(b,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:a[2]||(a[2]=r=>i.value=!n(i))},{icon:t(()=>[n(i)?(s(),f(K,{key:1})):(s(),f(J,{key:0}))]),default:t(()=>[y(m(n(i)?"展开":"收起"),1)]),_:1}))],!0)]),_:3})]),_:3},16,["span","suffix"])):v("",!0)]),_:3},16,["collapsed"])]),_:3},16,["model"])}}}),pe=oe(de,[["__scopeId","data-v-2931024a"]]);export{pe as _};
