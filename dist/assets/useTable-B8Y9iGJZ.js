import{u as z}from"./useBreakpoint-DAFsyWcD.js";import"./index-COakebNL.js";import{r as D,w as M,v as k,a as v,c as B}from"./vue-_iYK9Zi6.js";import{ac as K,a9 as R}from"./arco-BuJQNAYO.js";function N(o,g={defaultPageSize:10}){const{breakpoint:c}=z(),e=D({showPageSize:!0,showTotal:!0,current:1,pageSize:g.defaultPageSize,total:0,simple:!1,onChange:a=>{e.current=a,o&&o()},onPageSizeChange:a=>{e.current=1,e.pageSize=a,o&&o()}});M(()=>c.value,()=>{e.simple=["xs"].includes(c.value),e.showTotal=!["xs"].includes(c.value)},{immediate:!0});const f=e.onChange,d=e.onPageSizeChange;function s(a){e.total=a}const{current:h,pageSize:i,total:u}=k(e);return{current:h,pageSize:i,total:u,pagination:e,changeCurrent:f,changePageSize:d,setTotal:s}}function F(o,g){const{formatResult:c,onSuccess:e,immediate:f=!0,rowKey:d="id"}=g||{},{pagination:s,setTotal:h}=N(()=>a()),i=v(!1),u=v([]);async function a(){try{i.value=!0;const t=await o({page:s.current,size:s.pageSize}),n=Array.isArray(t.data)?t.data:t.data.records;u.value=c?c(n):n;const r=Array.isArray(t.data)?n.length:t.data.total;h(r),e?.()}finally{i.value=!1}}f&&a();const l=v([]),S=t=>{l.value=t},w=t=>{const n=u.value.filter(r=>!(r?.disabled??!1));l.value=t?n.map(r=>r[d]):[]},C=()=>{l.value=[],s.onChange(1)},P=()=>{a()},T=async(t,n)=>{const r=async y=>{try{const m=await t();if(m.success){R.success(n?.successTip||"删除成功！");const b=y?l.value.length:1,p=Math.ceil((s.total-b)/s.pageSize);s.current>p&&(s.current=p>0?p:1),y&&(l.value=[]),a()}return m.success}catch{return!1}};if(!(n?.showModal??!0))return r(!1);K.warning({title:n?.title||"提示",content:n?.content||"是否确认删除？",hideCancel:!1,maskClosable:!1,onBeforeOk:()=>r(!0)})},{breakpoint:x}=z(),A=B(()=>["xs","sm"].includes(x.value)?void 0:"right");return{loading:i,tableData:u,getTableData:a,search:C,pagination:s,selectedKeys:l,select:S,selectAll:w,handleDelete:T,refresh:P,fixed:A}}export{F as u};
