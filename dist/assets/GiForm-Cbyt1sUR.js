import{o as ae}from"./omit-CEMUVuEh.js";import{d2 as le,_ as te}from"./index-DUGl7QlM.js";import{ae as a}from"./arco-B8E_0xxC.js";import{e as se,c as F,ac as ne,a as de,r as ue,w as ce,h as c,j as p,k as s,E as i,a1 as d,l as n,t as _,n as C,p as v,P as S,F as P,G as E,y,z as g,O as V,u as T}from"./vue-Bh0u9iwh.js";const pe=se({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(O,{expose:D,emit:M}){const o=O,h=M,G={input:a.Input,"input-number":a.InputNumber,"input-tag":a.InputTag,"input-search":a.InputSearch,textarea:a.Textarea,select:a.Select,"tree-select":a.TreeSelect,"radio-group":a.RadioGroup,"checkbox-group":a.CheckboxGroup,"date-picker":a.DatePicker,"year-picker":a.YearPicker,"quarter-picker":a.QuarterPicker,"month-picker":a.MonthPicker,"week-picker":a.WeekPicker,"time-picker":a.TimePicker,"range-picker":a.RangePicker,"color-picker":a.ColorPicker,rate:a.Rate,switch:a.Switch,slider:a.Slider,cascader:a.Cascader,upload:a.Upload,"auto-complete":a.AutoComplete,mention:a.Mention},N=F(()=>{const e=ae(o,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:o.search?"inline":"horizontal",...e}}),w=F(()=>o.gridItemProps),A=ne("formRef"),m=de(o.defaultCollapsed),k=ue({}),j=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),R=e=>e?.fieldName||e.field,z=e=>{if(e.type){if(["input","input-tag","mention"].includes(e.type))return`请输入${e.label}`;if(["textarea"].includes(e.type))return`请填写${e.label}`;if(["select","input-search","tree-select","cascader"].includes(e.type))return`请选择${e.label}`;if(["date-picker"].includes(e.type))return"请选择日期";if(["time-picker"].includes(e.type))return"请选择时间"}},L=e=>{if(!e.type)return;if(["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type))return k[e.field]||[]},U=e=>({...j.get(e.type)||{},placeholder:z(e),options:L(e),...e.props}),W=(e,l)=>{h("update:modelValue",Object.assign(o.modelValue,{[l]:e}))},H=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,Q=e=>{if(typeof e.show=="boolean")return e.show;if(typeof e.show=="function")return e.show(o.modelValue)},Y=e=>{if(e.hide===void 0)return!1;if(typeof e.hide=="boolean")return e.hide;if(typeof e.hide=="function")return e.hide(o.modelValue)},$=e=>{if(e.disabled===void 0)return!1;if(typeof e.disabled=="boolean")return e.disabled;if(typeof e.disabled=="function")return e.disabled(o.modelValue)};o.columns.forEach(e=>{e.request&&typeof e.request=="function"&&e?.init&&e.request(o.modelValue).then(l=>{k[e.field]=e.resultFormat?e.resultFormat(l):l.data})});const I=[];o.columns.forEach(e=>{const l=I.map(f=>f.field);e.cascader?.length&&!l.includes(e.field)&&I.push(e)});const J=F(()=>le(o.modelValue));return ce(J,(e,l)=>{I.forEach(f=>{e[f.field]!==l[f.field]&&o.columns.filter(t=>f?.cascader?.includes(t.field)).forEach(t=>{t.request&&e[f.field]?t.request(o.modelValue).then(x=>{k[t.field]=t.resultFormat?t.resultFormat(x):x.data,k[t.field].map(b=>b.value).includes(o.modelValue[t.field])||h("update:modelValue",Object.assign(o.modelValue,{[t.field]:Array.isArray(o.modelValue[t.field])?[]:""}))}):t.request&&!e[f.field]&&(k[t.field]=[],h("update:modelValue",Object.assign(o.modelValue,{[t.field]:Array.isArray(o.modelValue[t.field])?[]:""})))})})}),D({formRef:A}),(e,l)=>{const f=c("a-alert"),q=c("a-form-item"),t=c("a-grid-item"),x=c("icon-search"),b=c("a-button"),K=c("icon-up"),X=c("icon-down"),Z=c("a-space"),ee=c("a-grid"),re=c("a-form");return s(),p(re,i({ref_key:"formRef",ref:A},d(N),{model:e.modelValue}),{default:n(()=>[_(ee,i({class:"w-full","col-gap":8},o.gridProps,{collapsed:d(m)}),{default:n(()=>[(s(!0),C(P,null,S(e.columns,r=>(s(),C(P,{key:r.field},[(r.show!==void 0?Q(r):!Y(r))?(s(),p(t,i({key:0,ref_for:!0},r.gridItemProps||d(w),{span:r.span||r.gridItemProps?.span||d(w)?.span}),{default:n(()=>[_(q,i({ref_for:!0},r.formItemProps,{field:r.field,rules:H(r),disabled:$(r)}),E({label:n(()=>[r.labelRender?(s(),p(V(r.labelRender),{key:0})):(s(),C(P,{key:1},[y(g(r.label),1)],64))]),default:n(()=>[["group-title"].includes(r.type||"")?T(e.$slots,"group-title",{key:1},()=>[_(f,i({ref_for:!0},r.props),{default:n(()=>[y(g(r.label),1)]),_:2},1040)],!0):T(e.$slots,r.field,i({key:0,ref_for:!0},{disabled:$(r)}),()=>[(s(),p(V(G[r.type||""]||r.type),i({ref_for:!0},U(r),{"model-value":e.modelValue[R(r)],"onUpdate:modelValue":u=>W(u,R(r))}),E({_:2},[S(r?.slots,(u,B)=>({name:B,fn:n(oe=>[typeof u=="string"?(s(),C(P,{key:0},[y(g(u),1)],64)):u?(s(),p(V(u(oe)),{key:1})):v("",!0)])}))]),1040,["model-value","onUpdate:modelValue"]))],!0)]),_:2},[S(r?.formItemSlots,(u,B)=>({name:B,fn:n(()=>[typeof u=="string"?(s(),C(P,{key:0},[y(g(u),1)],64)):(s(),p(V(u),{key:1}))])}))]),1040,["field","rules","disabled"])]),_:2},1040,["span"])):v("",!0)],64))),128)),o.search?(s(),p(t,i({key:o.suffix?void 0:String(d(m))},d(w),{span:d(w)?.span,suffix:o.search&&(o.suffix||!o.suffix&&d(m))}),{default:n(()=>[_(Z,{wrap:""},{default:n(()=>[T(e.$slots,"suffix",{},()=>[_(b,{type:"primary",onClick:l[0]||(l[0]=r=>h("search"))},{icon:n(()=>[_(x)]),default:n(()=>[y(g(o.searchBtnText),1)]),_:1}),_(b,{onClick:l[1]||(l[1]=r=>h("reset"))},{default:n(()=>l[3]||(l[3]=[y("重置",-1)])),_:1,__:[3]}),o.hideFoldBtn?v("",!0):(s(),p(b,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:l[2]||(l[2]=r=>m.value=!d(m))},{icon:n(()=>[d(m)?(s(),p(X,{key:1})):(s(),p(K,{key:0}))]),default:n(()=>[y(g(d(m)?"展开":"收起"),1)]),_:1}))],!0)]),_:3})]),_:3},16,["span","suffix"])):v("",!0)]),_:3},16,["collapsed"])]),_:3},16,["model"])}}}),ye=te(pe,[["__scopeId","data-v-d6065d23"]]);export{ye as _};
