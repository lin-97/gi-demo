import{b as Y}from"./user-CNRP42a7.js";import"./index-BJpBVVpn.js";import{u as $}from"./useResetReactive-8TRckTE7.js";import{u as G}from"./useDept-CwNsxYyO.js";import{b as J}from"./role-0WIy0paV.js";import{a as m,e as K,c as h,ac as Q,h as d,j as X,k as Z,a1 as l,Y as ee,l as s,t as a,S as b,U as V,y as R}from"./vue-_iYK9Zi6.js";import{a as le,E as ae}from"./regexp-BWv6Tqg2.js";import{a9 as te}from"./arco-CDZlpuCh.js";function oe(){const p=m(!1),c=m([]),f=m(0);return{roleList:c,getRoleList:async()=>{try{p.value=!0;const _=await J.getList({page:1,size:99});c.value=_.data.records.filter(w=>w.status===1),f.value=_.data.total}finally{p.value=!1}},loading:p,total:f}}const ce=K({__name:"AddUserModal",emits:["save-success"],setup(p,{expose:c,emit:f}){const y=f,{roleList:_,getRoleList:w}=oe();w();const U=h(()=>_.value.map(r=>({label:r.name,value:r.code}))),{deptList:L,getDeptList:M}=G();M();const g={xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},x=Q("formRef"),k=m(""),P=h(()=>!!k.value),q=h(()=>P.value?"编辑用户":"新增用户"),u=m(!1),[t,z]=$({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:"",roleIds:[],description:"",status:1,type:2,disabled:!1}),C={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:ae,message:"邮箱格式不正确"}],phone:[{match:le,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},A=()=>{k.value="",u.value=!0},B=async r=>{u.value=!0,k.value=r;const e=await Y.getDetail({id:r});Object.assign(t,e.data)},D=()=>{x.value?.resetFields(),z()},E=async()=>{try{return await x.value?.validate()?!1:await await new Promise(i=>setTimeout(()=>i(!0),300))?(te.success("模拟保存成功"),y("save-success"),!0):!1}catch{return!1}};return c({add:A,edit:B}),(r,e)=>{const i=d("a-input"),n=d("a-form-item"),v=d("a-col"),O=d("a-row"),I=d("a-radio"),T=d("a-radio-group"),j=d("a-tree-select"),F=d("a-select"),N=d("a-textarea"),H=d("a-switch"),S=d("a-form"),W=d("a-modal");return Z(),X(W,{visible:l(u),"onUpdate:visible":e[9]||(e[9]=o=>ee(u)?u.value=o:null),title:l(q),width:"90%","mask-closable":!1,"modal-style":{maxWidth:"600px"},"body-style":{maxHeight:"70vh"},onBeforeOk:E,onClose:D},{default:s(()=>[a(S,{ref_key:"formRef",ref:x,model:l(t),rules:C,size:"medium","auto-label-width":""},{default:s(()=>[a(O,null,{default:s(()=>[a(v,b(V(g)),{default:s(()=>[a(n,{label:"用户名",field:"username"},{default:s(()=>[a(i,{modelValue:l(t).username,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).username=o),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":"",disabled:l(t).disabled,"max-length":10},null,8,["modelValue","disabled"])]),_:1})]),_:1},16),a(v,b(V(g)),{default:s(()=>[a(n,{label:"昵称",field:"nickname"},{default:s(()=>[a(i,{modelValue:l(t).nickname,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).nickname=o),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":"","max-length":10},null,8,["modelValue"])]),_:1})]),_:1},16),a(v,b(V(g)),{default:s(()=>[a(n,{label:"手机号码",field:"phone"},{default:s(()=>[a(i,{modelValue:l(t).phone,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).phone=o),modelModifiers:{trim:!0},placeholder:"请输入手机号码","allow-clear":"","max-length":11},null,8,["modelValue"])]),_:1})]),_:1},16),a(v,b(V(g)),{default:s(()=>[a(n,{label:"邮箱",field:"email"},{default:s(()=>[a(i,{modelValue:l(t).email,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).email=o),modelModifiers:{trim:!0},placeholder:"请输入邮箱","allow-clear":"","max-length":30},null,8,["modelValue"])]),_:1})]),_:1},16)]),_:1}),a(n,{label:"性别",field:"gender"},{default:s(()=>[a(T,{modelValue:l(t).gender,"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).gender=o)},{default:s(()=>[a(I,{value:1},{default:s(()=>e[10]||(e[10]=[R("男",-1)])),_:1,__:[10]}),a(I,{value:2},{default:s(()=>e[11]||(e[11]=[R("女",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"所属部门",field:"deptId"},{default:s(()=>[a(j,{modelValue:l(t).deptId,"onUpdate:modelValue":e[5]||(e[5]=o=>l(t).deptId=o),data:l(L),"field-names":{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:l(t).disabled},null,8,["modelValue","data","disabled"])]),_:1}),a(n,{label:"角色",field:"roleIds",disabled:l(t).disabled},{default:s(()=>[a(F,{modelValue:l(t).roleIds,"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).roleIds=o),options:l(U),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])]),_:1},8,["disabled"]),a(n,{label:"描述",field:"description"},{default:s(()=>[a(N,{modelValue:l(t).description,"onUpdate:modelValue":e[7]||(e[7]=o=>l(t).description=o),modelModifiers:{trim:!0},"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])]),_:1}),a(n,{label:"状态",field:"status"},{default:s(()=>[a(H,{modelValue:l(t).status,"onUpdate:modelValue":e[8]||(e[8]=o=>l(t).status=o),type:"round","checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])}}});export{ce as _};
