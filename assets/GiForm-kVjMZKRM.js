import{o as re}from"./omit-D7h5lgcv.js";import{d2 as oe,_ as te}from"./index-D1V-3yfm.js";import{e as le,c as B,ac as se,a as ne,r as ue,w as de,h as d,j as c,k as l,E as i,a1 as n,l as s,t as y,n as b,p as x,P as F,F as C,G as $,y as m,z as _,O as v,u as S}from"./vue-CNbhFRxi.js";import{ah as ce,ai as pe,aj as fe,ak as ie,al as ye,am as me,an as _e,ao as ge,ap as he,aq as ke,ar as be,as as Ce,at as Pe,au as we,av as xe,aw as ve,ax as Ve,ay as Ie,az as Be,aA as Fe,aB as Se,aC as Te,aD as Ae,aE as Re}from"./arco-DTGWTKTH.js";const qe=le({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(E,{expose:D,emit:O}){const r=E,g=O,M={input:Re,"input-number":Ae,"input-tag":Te,"input-search":Se,textarea:Fe,select:Be,"tree-select":Ie,"radio-group":Ve,"checkbox-group":ve,"date-picker":xe,"year-picker":we,"quarter-picker":Pe,"month-picker":Ce,"week-picker":be,"time-picker":ke,"range-picker":he,"color-picker":ge,rate:_e,switch:me,slider:ye,cascader:ie,upload:fe,"auto-complete":pe,mention:ce},j=B(()=>{const e=re(r,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:r.search?"inline":"horizontal",...e}}),P=B(()=>r.gridItemProps),T=se("formRef"),f=ne(r.defaultCollapsed),h=ue({}),z=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),A=e=>e?.fieldName||e.field,G=e=>{if(!(!e.type||typeof e.type!="string")){if(["input","input-tag","mention"].includes(e.type))return`请输入${e.label}`;if(["textarea"].includes(e.type))return`请填写${e.label}`;if(["select","input-search","tree-select","cascader"].includes(e.type))return`请选择${e.label}`;if(["date-picker"].includes(e.type))return"请选择日期";if(["time-picker"].includes(e.type))return"请选择时间"}},N=e=>{if(!e.type)return;const o=["select","tree-select","cascader","radio-group","checkbox-group"];if(typeof e.type=="string"&&o.includes(e.type))return h[e.field]||[]},L=e=>({...z.get(e.type)||{},placeholder:G(e),options:N(e),...e.props}),U=(e,o)=>{g("update:modelValue",Object.assign(r.modelValue,{[o]:e}))},W=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,H=e=>{if(typeof e.show=="boolean")return e.show;if(typeof e.show=="function")return e.show(r.modelValue)},Q=e=>{if(e.hide===void 0)return!1;if(typeof e.hide=="boolean")return e.hide;if(typeof e.hide=="function")return e.hide(r.modelValue)},R=e=>{if(e.disabled===void 0)return!1;if(typeof e.disabled=="boolean")return e.disabled;if(typeof e.disabled=="function")return e.disabled(r.modelValue)};r.columns.forEach(e=>{e.request&&typeof e.request=="function"&&e?.init&&e.request(r.modelValue).then(o=>{h[e.field]=e.resultFormat?e.resultFormat(o):o.data})});const V=[];r.columns.forEach(e=>{const o=V.map(p=>p.field);e.cascader?.length&&!o.includes(e.field)&&V.push(e)});const Y=B(()=>oe(r.modelValue));return de(Y,(e,o)=>{V.forEach(p=>{e[p.field]!==o[p.field]&&r.columns.filter(t=>p?.cascader?.includes(t.field)).forEach(t=>{t.request&&e[p.field]?t.request(r.modelValue).then(w=>{h[t.field]=t.resultFormat?t.resultFormat(w):w.data,h[t.field].map(k=>k.value).includes(r.modelValue[t.field])||g("update:modelValue",Object.assign(r.modelValue,{[t.field]:Array.isArray(r.modelValue[t.field])?[]:""}))}):t.request&&!e[p.field]&&(h[t.field]=[],g("update:modelValue",Object.assign(r.modelValue,{[t.field]:Array.isArray(r.modelValue[t.field])?[]:""})))})})}),D({formRef:T}),(e,o)=>{const p=d("a-alert"),q=d("a-form-item"),t=d("a-grid-item"),w=d("icon-search"),k=d("a-button"),J=d("icon-up"),K=d("icon-down"),X=d("a-space"),Z=d("a-grid"),ee=d("a-form");return l(),c(ee,i({ref_key:"formRef",ref:T},n(j),{model:e.modelValue}),{default:s(()=>[y(Z,i({class:"w-full","col-gap":8},r.gridProps,{collapsed:n(f)}),{default:s(()=>[(l(!0),b(C,null,F(e.columns,a=>(l(),b(C,{key:a.field},[(a.show!==void 0?H(a):!Q(a))?(l(),c(t,i({key:0,ref_for:!0},a.gridItemProps||n(P),{span:a.span||a.gridItemProps?.span||n(P)?.span}),{default:s(()=>[y(q,i({ref_for:!0},a.formItemProps,{field:a.field,rules:W(a),disabled:R(a)}),$({label:s(()=>[a.labelRender?(l(),c(v(a.labelRender),{key:0})):(l(),b(C,{key:1},[m(_(a.label),1)],64))]),default:s(()=>[["group-title"].includes(typeof a.type=="string"?a.type:"")?S(e.$slots,"group-title",{key:1},()=>[y(p,null,{default:s(()=>[m(_(a.label),1)]),_:2},1024)],!0):S(e.$slots,a.field,i({key:0,ref_for:!0},{disabled:R(a)}),()=>[(l(),c(v(M[typeof a.type=="string"?a.type:""]||a.type),i({ref_for:!0},L(a),{"model-value":e.modelValue[A(a)],"onUpdate:modelValue":u=>U(u,A(a))}),$({_:2},[F(a?.slots,(u,I)=>({name:I,fn:s(ae=>[typeof u=="string"?(l(),b(C,{key:0},[m(_(u),1)],64)):u?(l(),c(v(u(ae)),{key:1})):x("",!0)])}))]),1040,["model-value","onUpdate:modelValue"]))],!0)]),_:2},[F(a?.formItemSlots,(u,I)=>({name:I,fn:s(()=>[typeof u=="string"?(l(),b(C,{key:0},[m(_(u),1)],64)):(l(),c(v(u),{key:1}))])}))]),1040,["field","rules","disabled"])]),_:2},1040,["span"])):x("",!0)],64))),128)),r.search?(l(),c(t,i({key:r.suffix?void 0:String(n(f))},n(P),{span:n(P)?.span,suffix:r.search&&(r.suffix||!r.suffix&&n(f))}),{default:s(()=>[y(X,{wrap:""},{default:s(()=>[S(e.$slots,"suffix",{},()=>[y(k,{type:"primary",onClick:o[0]||(o[0]=a=>g("search"))},{icon:s(()=>[y(w)]),default:s(()=>[m(_(r.searchBtnText),1)]),_:1}),y(k,{onClick:o[1]||(o[1]=a=>g("reset"))},{default:s(()=>o[3]||(o[3]=[m("重置",-1)])),_:1,__:[3]}),r.hideFoldBtn?x("",!0):(l(),c(k,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:o[2]||(o[2]=a=>f.value=!n(f))},{icon:s(()=>[n(f)?(l(),c(K,{key:1})):(l(),c(J,{key:0}))]),default:s(()=>[m(_(n(f)?"展开":"收起"),1)]),_:1}))],!0)]),_:3})]),_:3},16,["span","suffix"])):x("",!0)]),_:3},16,["collapsed"])]),_:3},16,["model"])}}}),Me=te(qe,[["__scopeId","data-v-2dbf22ae"]]);export{Me as _};
